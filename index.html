<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Google Shopping 热门搜索</title>
  <style>
    body{margin:0;padding:10px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#fafafa;color:#222}
    h1{font-size:clamp(16px,2.2vw,20px);margin:0 0 8px;line-height:1.25}
    #panel{width:100%}
    #panel iframe{
      width:100% !important;
      height:clamp(320px,72vh,760px) !important;
      border:0;display:block
    }
  </style>
</head>
<body>
  <h1 id="title">加载中…</h1>
  <div id="panel"></div>

  <script src="https://ssl.gstatic.com/trends_nrtr/4116_RC01/embed_loader.js"></script>
  <script>
    const qs      = new URLSearchParams(location.search);
    const geo     = (qs.get("geo")  || "US").trim();
    const date    = (qs.get("date") || "now 7-d").trim();
    const hl      = (qs.get("hl")   || "zh-CN").trim();
    const h       = qs.get("h");
    const compact = qs.get("compact")==="1";

    // ▼▼▼【核心修改点】▼▼▼
    // 将搜索属性固定为 "Google Shopping"
    const GPROP = "froogle";
    // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

    const dateLabel = ({
      "now 1-H":"近 1 小时","now 4-H":"近 4 小时","now 1-d":"近 1 天",
      "now 7-d":"近 7 天","today 1-m":"近 1 个月","today 3-m":"近 3 个月",
      "today 12-m":"近 12 个月","all":"全部时间"
    })[date] || date;

    const d = new Date();
    const todayStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;

    const titleEl = document.getElementById("title");
    titleEl.textContent = `${geo} ${dateLabel} Google购物热门 ${todayStr}`; // 更新了标题
    if (compact) titleEl.style.display = "none";

    const exploreQuery =
      `date=${encodeURIComponent(date)}&geo=${encodeURIComponent(geo)}&hl=${encodeURIComponent(hl)}&gprop=${GPROP}&cmpt=q`; // 添加了 gprop 参数

    trends.embed.renderExploreWidget(
      "RELATED_QUERIES",
      { "comparisonItem":[{ "geo": geo, "time": date, "keyword": "shopping" }], "property": GPROP }, // ★ 修改点1: 指定 property
      { "exploreQuery": exploreQuery, "guestPath": "https://trends.google.com/trends/embed/" },
      document.getElementById("panel")
    );

    if (h) {
      const applyHeight = () => {
        const ifr = document.querySelector("#panel iframe");
        if (ifr) ifr.style.height = `${Math.max(220, Math.min(1200, parseInt(h,10)||0))}px`;
      };
      new MutationObserver((m,obs)=>{ applyHeight(); obs.disconnect(); })
        .observe(document.getElementById("panel"), {childList:true,subtree:true});
      window.addEventListener("resize", applyHeight);
    }
  </script>
</body>
</html>
